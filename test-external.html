<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <title>–¢–µ—Å—Ç –≤–∏–¥–∂–µ—Ç–∞ widget-external.js</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <style>
      /* –°–∏–º—É–ª—è—Ü–∏—è —Å—Ç–∏–ª–µ–π —Å–∞–π—Ç–∞-—Ö–æ–∑—è–∏–Ω–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–æ–ª—è—Ü–∏–∏ */
      body {
        font-family: Comic Sans MS, cursive;
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: #333;
        margin: 0;
        padding: 20px;
      }
      
      * {
        box-sizing: content-box;
        margin: 10px;
        padding: 10px;
      }
      
      button {
        background: red !important;
        color: yellow !important;
        border: 5px solid blue !important;
      }
      
      .test-content {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      
      h1 {
        color: #ff6b6b;
        text-align: center;
      }
      
      .test-section {
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
      }
      
      .test-section h2 {
        color: #4ecdc4;
        margin-bottom: 15px;
      }
      
      .test-button {
        background: #4ecdc4;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      
      .test-button:hover {
        background: #45b8b0;
      }
      
      .log {
        background: #2d3436;
        color: #00ff00;
        padding: 15px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="test-content">
      <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ widget-external.js</h1>
      
      <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞</h2>
        <p>–í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Å—Ç–∏–ª–∏ —Å–∞–π—Ç–∞.</p>
        <div id="widget-status" style="padding: 10px; background: #e8f5e9; border-radius: 5px; margin-top: 10px;">
          –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞...
        </div>
      </div>
      
      <div class="test-section">
        <h2>2. –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å GAS</h2>
        <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ª–∏–¥ –≤ Google Sheets:</p>
        <button class="test-button" onclick="testGASIntegration()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ª–∏–¥ –≤ GAS</button>
        <div id="gas-result" style="margin-top: 10px;"></div>
      </div>
      
      <div class="test-section">
        <h2>3. –¢–µ—Å—Ç –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç OpenAI</h2>
        <p>–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∏–¥–∂–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å: <strong>"–∫–∞–∫–∏–µ –µ—Å—Ç—å –¥–∏–≤–∞–Ω—ã?"</strong></p>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</p>
        <button class="test-button" onclick="openWidget()">–û—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–∂–µ—Ç</button>
      </div>
      
      <div class="test-section">
        <h2>4. –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
        <div id="event-log" class="log">–õ–æ–≥–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...</div>
      </div>
    </div>
    
    <script>
      function log(message, type = 'info') {
        const logEl = document.getElementById('event-log');
        const timestamp = new Date().toLocaleTimeString();
        const colors = {
          info: '#00ff00',
          error: '#ff0000',
          success: '#00ff88',
          warning: '#ffff00'
        };
        logEl.innerHTML += `<div style="color: ${colors[type] || colors.info}">[${timestamp}] ${message}</div>`;
        logEl.scrollTop = logEl.scrollHeight;
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞
      window.addEventListener('load', () => {
        setTimeout(() => {
          const widget = document.querySelector('.vfw-root');
          if (widget) {
            document.getElementById('widget-status').innerHTML = 
              '<span style="color: green;">‚úÖ –í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!</span>';
            log('–í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è', 'success');
          } else {
            document.getElementById('widget-status').innerHTML = 
              '<span style="color: red;">‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</span>';
            log('–í–∏–¥–∂–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ', 'error');
          }
        }, 2000);
      });
      
      // –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å GAS
      async function testGASIntegration() {
        const resultEl = document.getElementById('gas-result');
        resultEl.innerHTML = '<p style="color: blue;">–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ª–∏–¥–∞...</p>';
        log('–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞ GAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏', 'info');
        
        try {
          // –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π URL –≤–∏–¥–∂–µ—Ç–∞
          const widgetScript = Array.from(document.scripts).find(s => s.src.includes('widget-external'));
          const widgetBaseUrl = widgetScript ? widgetScript.src.substring(0, widgetScript.src.lastIndexOf('/') + 1) : window.location.origin + '/';
          const leadUrl = widgetBaseUrl + 'api/lead';
          
          log(`–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è URL: ${leadUrl}`, 'info');
          
          const response = await fetch(leadUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              gas_url: 'https://script.google.com/macros/s/AKfycbxiJrvTNiGfXTbfFWMiTWEGAyh4RKFhoKU8zjIfmQqrZlphC_vdO4R_OS9zhd-gYoZJOw/exec',
              timestamp: new Date().toISOString(),
              name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
              phone: '+375291234567',
              pretext: '–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ widget-external.js',
              page_url: window.location.href,
              session_id: 'test_session_' + Date.now()
            })
          });
          
          const data = await response.json();
          
          if (response.ok && data.ok) {
            resultEl.innerHTML = '<p style="color: green;">‚úÖ –õ–∏–¥ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ GAS!</p>';
            log('–õ–∏–¥ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ GAS', 'success');
            log(`–û—Ç–≤–µ—Ç: ${JSON.stringify(data)}`, 'info');
          } else {
            resultEl.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>`;
            log(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–∏–¥–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
          }
        } catch (error) {
          resultEl.innerHTML = `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
          log(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
        }
      }
      
      // –û—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–∂–µ—Ç
      function openWidget() {
        const widgetBtn = document.querySelector('.vfw-btn');
        if (widgetBtn) {
          widgetBtn.click();
          log('–í–∏–¥–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ', 'info');
        } else {
          log('–ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
        }
      }
      
      // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤–∏–¥–∂–µ—Ç–∞
      window.addEventListener('error', (e) => {
        log(`–û—à–∏–±–∫–∞ JavaScript: ${e.message}`, 'error');
      });
      
      log('–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
    </script>
    
    <script>
      (function(){
        var s=document.createElement('script');
        s.src='./widget-external.js?v=5.1.0';
        s.defer=true;
        s.dataset.prompt='./prompt.json';
        s.dataset.gas='https://script.google.com/macros/s/AKfycbxiJrvTNiGfXTbfFWMiTWEGAyh4RKFhoKU8zjIfmQqrZlphC_vdO4R_OS9zhd-gYoZJOw/exec';
        document.head.appendChild(s);
        console.log('Widget script added to page');
      })();
    </script>
  </body>
</html>


