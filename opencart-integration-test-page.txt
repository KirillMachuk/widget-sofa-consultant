<!-- 
  Код для тестирования виджета на ОДНОЙ странице nm-shop.by
  Используйте этот код для проверки работы перед установкой на весь сайт
  
  ИНСТРУКЦИЯ:
  1. Выберите страницу для тестирования (например, главная или конкретный товар)
  2. Определите URL страницы (например: /index.php?route=common/home или /product/123)
  3. В коде ниже замените '/ваш-url-страницы' на реальный URL
  4. Вставьте код в header.twig ПЕРЕД </head>
  5. После тестирования замените на полную версию (opencart-integration-simple.txt)
-->

<link rel="preconnect" href="https://widget-nine-murex.vercel.app">
<link rel="preconnect" href="https://api.openai.com">

<script>
(function() {
  // Защита от двойной загрузки
  if (window.nmShopWidgetLoaded) return;
  
  // ⚠️ ВАЖНО: Укажите URL страницы для тестирования
  // Примеры:
  // - Главная: '/index.php?route=common/home' или '/'
  // - Товар: '/index.php?route=product/product&product_id=123'
  // - Категория: '/index.php?route=product/category&path=20'
  
  const TEST_PAGE_URL = '/'; // ← ЗАМЕНИТЕ на URL вашей тестовой страницы
  
  // Проверка: показывать виджет только на указанной странице
  const currentPath = window.location.pathname + window.location.search;
  const isTestPage = currentPath === TEST_PAGE_URL || 
                     currentPath.startsWith(TEST_PAGE_URL) ||
                     window.location.href.includes(TEST_PAGE_URL);
  
  if (!isTestPage) {
    console.log('Chat widget: тестовая страница не совпадает, виджет не загружается');
    return; // Не загружаем виджет на других страницах
  }
  
  console.log('Chat widget: загрузка на тестовой странице:', currentPath);
  window.nmShopWidgetLoaded = true;
  
  var s = document.createElement('script');
  s.src = 'https://widget-nine-murex.vercel.app/widget.js?v=5.1.0';
  s.defer = true;
  s.dataset.api = 'https://widget-nine-murex.vercel.app/api/chat';
  s.dataset.prompt = 'https://widget-nine-murex.vercel.app/Промпт.json';
  s.dataset.gas = 'https://script.google.com/macros/s/AKfycbxiJrvTNiGfXTbfFWMiTWEGAyh4RKFhoKU8zjIfmQqrZlphC_vdO4R_OS9zhd-gYoZJOw/exec';
  s.onerror = function() { 
    console.warn('Chat widget failed to load'); 
  };
  document.head.appendChild(s);
})();
</script>

<style>
.vfw-root { z-index: 9999999 !important; }
@media (max-width: 768px) {
  .vfw-root { bottom: 80px !important; }
}
.vfw-panel { z-index: 9999999 !important; }
</style>

